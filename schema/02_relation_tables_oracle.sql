-- ============================================================
-- ICT 운영관리 - 관계 테이블 (Oracle)
-- 서버-솔루션 N:M, 서버/솔루션별 담당자 2명, 벤더 2명
-- ============================================================

-- 서버별 설치 솔루션 (서버 1 : 솔루션 N)
CREATE TABLE "SERVER_SOLUTION" (
    "SERVER_SOLUTION_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SERVER_ID"         NUMBER(10) NOT NULL,  -- 서버 ID
    "SOLUTION_ID"       NUMBER(10) NOT NULL,  -- 솔루션 ID
    "INSTALLED_VERSION" VARCHAR2(50),         -- 설치된 버전
    "INSTALLED_AT"      DATE,                 -- 설치일
    "NOTES"             CLOB,                 -- 비고
    "CREATED_AT"        TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "UK_SERVER_SOLUTION" UNIQUE ("SERVER_ID", "SOLUTION_ID"),
    CONSTRAINT "FK_SS_SERVER" FOREIGN KEY ("SERVER_ID") REFERENCES "SERVER_MASTER"("SERVER_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SS_SOLUTION" FOREIGN KEY ("SOLUTION_ID") REFERENCES "SOLUTION_MASTER"("SOLUTION_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SERVER_SOLUTION" IS '서버별 설치 솔루션 (한 서버에 여러 솔루션 설치)';
COMMENT ON COLUMN "SERVER_SOLUTION"."SERVER_SOLUTION_ID" IS 'PK';
COMMENT ON COLUMN "SERVER_SOLUTION"."SERVER_ID" IS '서버 ID';
COMMENT ON COLUMN "SERVER_SOLUTION"."SOLUTION_ID" IS '솔루션 ID';
COMMENT ON COLUMN "SERVER_SOLUTION"."INSTALLED_VERSION" IS '설치된 버전';
COMMENT ON COLUMN "SERVER_SOLUTION"."INSTALLED_AT" IS '설치일';
COMMENT ON COLUMN "SERVER_SOLUTION"."NOTES" IS '비고';


-- 서버 담당자 (서버당 담당자 2명, position 1=1차, 2=2차)
CREATE TABLE "SERVER_STAFF" (
    "SERVER_STAFF_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SERVER_ID"       NUMBER(10) NOT NULL,  -- 서버 ID
    "STAFF_ID"        NUMBER(10) NOT NULL,  -- 담당자 ID
    "POSITION"        NUMBER(5) NOT NULL,  -- 1=1차 담당자, 2=2차 담당자
    "CREATED_AT"      TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SERVER_STAFF_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SERVER_STAFF" UNIQUE ("SERVER_ID", "POSITION"),
    CONSTRAINT "FK_SRVS_STAFF_SERVER" FOREIGN KEY ("SERVER_ID") REFERENCES "SERVER_MASTER"("SERVER_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SRVS_STAFF_STAFF" FOREIGN KEY ("STAFF_ID") REFERENCES "STAFF_MASTER"("STAFF_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SERVER_STAFF" IS '서버 담당자 (1차/2차 각 1명)';
COMMENT ON COLUMN "SERVER_STAFF"."POSITION" IS '1=1차 담당자, 2=2차 담당자';


-- 서버 벤더 (서버당 벤더 2곳, position 1=1차, 2=2차)
CREATE TABLE "SERVER_VENDOR" (
    "SERVER_VENDOR_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SERVER_ID"        NUMBER(10) NOT NULL,  -- 서버 ID
    "VENDOR_ID"        NUMBER(10) NOT NULL,  -- 벤더 ID
    "POSITION"         NUMBER(5) NOT NULL,  -- 1=1차 벤더, 2=2차 벤더
    "CONTRACT_TYPE"    VARCHAR2(100),       -- 계약 유형
    "CREATED_AT"       TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SERVER_VENDOR_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SERVER_VENDOR" UNIQUE ("SERVER_ID", "POSITION"),
    CONSTRAINT "FK_SRVV_SERVER" FOREIGN KEY ("SERVER_ID") REFERENCES "SERVER_MASTER"("SERVER_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SRVV_VENDOR" FOREIGN KEY ("VENDOR_ID") REFERENCES "VENDOR_MASTER"("VENDOR_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SERVER_VENDOR" IS '서버 벤더 (1차/2차 각 1곳)';
COMMENT ON COLUMN "SERVER_VENDOR"."POSITION" IS '1=1차 벤더, 2=2차 벤더';


-- 솔루션 담당자 (솔루션당 담당자 2명)
CREATE TABLE "SOLUTION_STAFF" (
    "SOLUTION_STAFF_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SOLUTION_ID"      NUMBER(10) NOT NULL,  -- 솔루션 ID
    "STAFF_ID"         NUMBER(10) NOT NULL,  -- 담당자 ID
    "POSITION"         NUMBER(5) NOT NULL,  -- 1=1차 담당자, 2=2차 담당자
    "CREATED_AT"       TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SOL_STAFF_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SOLUTION_STAFF" UNIQUE ("SOLUTION_ID", "POSITION"),
    CONSTRAINT "FK_SOLS_STAFF_SOL" FOREIGN KEY ("SOLUTION_ID") REFERENCES "SOLUTION_MASTER"("SOLUTION_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SOLS_STAFF_STAFF" FOREIGN KEY ("STAFF_ID") REFERENCES "STAFF_MASTER"("STAFF_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SOLUTION_STAFF" IS '솔루션 담당자 (1차/2차 각 1명)';


-- 솔루션 벤더 (솔루션당 벤더 2곳)
CREATE TABLE "SOLUTION_VENDOR" (
    "SOLUTION_VENDOR_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SOLUTION_ID"        NUMBER(10) NOT NULL,  -- 솔루션 ID
    "VENDOR_ID"          NUMBER(10) NOT NULL,  -- 벤더 ID
    "POSITION"           NUMBER(5) NOT NULL,  -- 1=1차 벤더, 2=2차 벤더
    "CONTRACT_TYPE"      VARCHAR2(100),       -- 계약 유형
    "CREATED_AT"         TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SOL_VENDOR_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SOLUTION_VENDOR" UNIQUE ("SOLUTION_ID", "POSITION"),
    CONSTRAINT "FK_SOLV_SOLUTION" FOREIGN KEY ("SOLUTION_ID") REFERENCES "SOLUTION_MASTER"("SOLUTION_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SOLV_VENDOR" FOREIGN KEY ("VENDOR_ID") REFERENCES "VENDOR_MASTER"("VENDOR_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SOLUTION_VENDOR" IS '솔루션 벤더 (1차/2차 각 1곳)';
