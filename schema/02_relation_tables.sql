-- ============================================================
-- ICT 운영관리 - 관계 테이블
-- 서버-솔루션 N:M, 서버/솔루션별 담당자
-- ============================================================

-- 서버별 설치 솔루션 (서버 1 : 솔루션 N)
CREATE TABLE "SERVER_SOLU" (
    "SERVER_SOLU_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SERVER_ID"         NUMBER(10) NOT NULL,  -- 서버 ID
    "SOLU_ID"       NUMBER(10) NOT NULL,  -- 솔루션 ID
    "INSTALLED_VERSION" VARCHAR2(50),         -- 설치된 버전
    "INSTALLED_AT"      DATE,                 -- 설치일
    "NOTES"             CLOB,                 -- 비고
    "CREATED_AT"        TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "UK_SERVER_SOLU" UNIQUE ("SERVER_ID", "SOLU_ID"),
    CONSTRAINT "FK_SS_SERVER" FOREIGN KEY ("SERVER_ID") REFERENCES "SERVER_MASTER"("SERVER_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SS_SOLU" FOREIGN KEY ("SOLU_ID") REFERENCES "SOLU_MASTER"("SOLU_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SERVER_SOLU" IS '서버별 설치 솔루션 (한 서버에 여러 솔루션 설치)';
COMMENT ON COLUMN "SERVER_SOLU"."SERVER_SOLU_ID" IS 'PK';
COMMENT ON COLUMN "SERVER_SOLU"."SERVER_ID" IS '서버 ID';
COMMENT ON COLUMN "SERVER_SOLU"."SOLU_ID" IS '솔루션 ID';
COMMENT ON COLUMN "SERVER_SOLU"."INSTALLED_VERSION" IS '설치된 버전';
COMMENT ON COLUMN "SERVER_SOLU"."INSTALLED_AT" IS '설치일';
COMMENT ON COLUMN "SERVER_SOLU"."NOTES" IS '비고';


-- 서버 담당자 (서버당 담당자 2명, position 1=1차, 2=2차)
CREATE TABLE "SERVER_STAFF" (
    "SERVER_STAFF_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SERVER_ID"       NUMBER(10) NOT NULL,  -- 서버 ID
    "STAFF_ID"        NUMBER(10) NOT NULL,  -- 담당자 ID
    "POSITION"        NUMBER(5) NOT NULL,  -- 1=1차 담당자, 2=2차 담당자
    "CREATED_AT"      TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SERVER_STAFF_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SERVER_STAFF" UNIQUE ("SERVER_ID", "POSITION"),
    CONSTRAINT "FK_SRVS_STAFF_SERVER" FOREIGN KEY ("SERVER_ID") REFERENCES "SERVER_MASTER"("SERVER_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SRVS_STAFF_STAFF" FOREIGN KEY ("STAFF_ID") REFERENCES "STAFF_MASTER"("STAFF_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SERVER_STAFF" IS '서버 담당자 (1차/2차 각 1명)';
COMMENT ON COLUMN "SERVER_STAFF"."POSITION" IS '1=1차 담당자, 2=2차 담당자';


-- 솔루션 담당자 (솔루션당 담당자 2명)
CREATE TABLE "SOLU_STAFF" (
    "SOLU_STAFF_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- PK
    "SOLU_ID"      NUMBER(10) NOT NULL,  -- 솔루션 ID
    "STAFF_ID"         NUMBER(10) NOT NULL,  -- 담당자 ID
    "POSITION"         NUMBER(5) NOT NULL,  -- 1=1차 담당자, 2=2차 담당자
    "CREATED_AT"       TIMESTAMP DEFAULT SYSTIMESTAMP,  -- 등록일시
    CONSTRAINT "CHK_SOL_STAFF_POS" CHECK ("POSITION" IN (1, 2)),
    CONSTRAINT "UK_SOLU_STAFF" UNIQUE ("SOLU_ID", "POSITION"),
    CONSTRAINT "FK_SOLS_STAFF_SOL" FOREIGN KEY ("SOLU_ID") REFERENCES "SOLU_MASTER"("SOLU_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_SOLS_STAFF_STAFF" FOREIGN KEY ("STAFF_ID") REFERENCES "STAFF_MASTER"("STAFF_ID") ON DELETE CASCADE
);

COMMENT ON TABLE "SOLU_STAFF" IS '솔루션 담당자 (1차/2차 각 1명)';
